<div
  class="space"
  *ngIf="{
    links: links$ | async | cloneDeep,
    nodes: nodes$ | async | cloneDeep,
    currentState: currentState$ | async,
    currentLink: currentLink$ | async
  } as viewData"
>
  <div class="space__graph">
    <ngx-graph [links]="viewData?.links" [nodes]="viewData?.nodes">
      <ng-template #nodeTemplate let-node>
        <svg:g class="node">
          <svg:rect
            [attr.width]="node.dimension.width"
            [attr.height]="node.dimension.height"
            [attr.fill]="node.data.customColor"
          />
          <svg:text
            alignment-baseline="central"
            [attr.x]="10"
            [attr.y]="node.dimension.height / 2"
          >
            {{ node.label }}
          </svg:text>
        </svg:g>
      </ng-template>

      <ng-template #defsTemplate>
        <svg:marker
          id="arrow"
          viewBox="0 -5 10 10"
          refX="8"
          refY="0"
          markerWidth="4"
          markerHeight="4"
          orient="auto"
        >
          <svg:path d="M0,-5L10,0L0,5" class="arrow-head" />
        </svg:marker>
      </ng-template>

      <ng-template #linkTemplate let-link>
        <svg:g class="edge">
          <svg:path
            class="line"
            stroke-width="2"
            marker-end="url(#arrow)"
            [attr.stroke]="link.data.customColor"
          ></svg:path>
          <svg:text class="edge-label" text-anchor="middle">
            <textPath
              class="text-path"
              [attr.href]="'#' + link.id"
              [style.dominant-baseline]="link.dominantBaseline"
              startOffset="50%"
              font-size="20"
              font-weight="500"
            >
              {{ link.data.cost | cost }}
            </textPath>
          </svg:text>
        </svg:g>
      </ng-template>
    </ngx-graph>
  </div>

  <div class="space__info">
    <div class="space__info__table" *ngIf="!!viewData?.currentState">
      <span class="space__info__table__left space__info__table__left--header">
        Node label
      </span>
      <span class="space__info__table__right space__info__table__right--header">
        Cost
      </span>

      <ng-container
        *ngFor="let item of viewData?.currentState?.matrix | keyvalue"
      >
        <span class="space__info__table__left">
          {{ item.key }}
        </span>
        <span
          class="space__info__table__right"
          [style]="item.value === Infinity ? 'color: red' : 'color: black'"
        >
          {{ item.value }}
        </span>
      </ng-container>
    </div>

    <div
      class="space__info__state"
      *ngIf="viewData?.currentState?.source && viewData?.currentState?.target"
    >
      <h2>Currently selected state:</h2>
      <ul
        *ngIf="{
          source: viewData?.currentState?.source,
          target: viewData?.currentState?.target,
          link: viewData?.currentLink
        } as state"
      >
        <li
          class="space__info__state__element"
          [style.backgroundColor]="linkBackgroundColor"
        >
          Link:
          <ul>
            <li>Id: {{ state.link.id }}</li>
            <li>Cost: {{ state.link.data.cost }}</li>
          </ul>
        </li>
        <li
          class="space__info__state__element"
          [style.backgroundColor]="nodeBackgroundColor"
        >
          Source:
          <ul>
            <li>Id: {{ state.source.id }}</li>
            <li>Label: {{ state.source.label }}</li>
          </ul>
        </li>
        <li
          class="space__info__state__element"
          [style.backgroundColor]="nodeBackgroundColor"
        >
          Target:
          <ul>
            <li>Id: {{ state.target.id }}</li>
            <li>Label: {{ state.target.label }}</li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</div>
